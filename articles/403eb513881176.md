---
title: "Jetpack Compose„ÅßËá™Âãï„Çπ„ÇØ„É≠„Éº„É´„Åô„Çã„ÉÜ„Ç≠„Çπ„Éà„ÅÆ‰ΩúÊàê"
emoji: "üéâ"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics:
  - "android"
  - "compose"
  - "animation"
published_at: "2024-11-25 16:31"
published: true
---

`Layout()`„Çí‰Ωø„Å£„Å¶ÊñáÂ≠óÂàó„ÅÆ„Çµ„Ç§„Ç∫„Å´Âêà„Çè„Åõ„Å¶„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Åï„Åõ„Çã

![](https://github.com/user-attachments/assets/0abd0a2f-a831-4795-9360-c68b625d8a66 =550x)


```kotlin
@Composable
fun AutoScrollText(
    modifier: Modifier = Modifier,
    text: String,
    style: TextStyle = LocalTextStyle.current,
) {
    val transition = rememberInfiniteTransition(
        label = "AutoScrollTextRepeater"
    )
    val textWidth = remember { mutableIntStateOf(0) }
    val layoutWidth = remember { mutableIntStateOf(0) }

    val transitionWidth = textWidth.intValue

    val animateX: Int by transition.animateValue(
        initialValue = layoutWidth.intValue,
        targetValue = -transitionWidth,
        typeConverter = Int.VectorConverter,
        animationSpec = infiniteRepeatable(
            animation = tween(
                durationMillis = transitionWidth * 15,
                delayMillis = 300,
                easing = LinearEasing
            ),
        )
    )

    Layout(
        modifier = modifier,
        content = {
            Text(
                text = text,
                style = style,
                maxLines = 1,
            )
        },
        measurePolicy = { measurable, constraints ->
            val textMeasurable = measurable.first()

            layoutWidth.intValue = constraints.maxWidth

            val placeable = textMeasurable.measure(
                // layout„ÅÆ„Çµ„Ç§„Ç∫„Å´Èñ¢„Çè„Çâ„ÅöÂÖ®„Å¶„ÇíË°®Á§∫„Åô„Çã
                constraints.copy(maxWidth = Int.MAX_VALUE)
            )
            val fixedWidth = placeable.width
            textWidth.intValue = fixedWidth
            layout(layoutWidth.intValue, placeable.height) {
                placeable.place(animateX, 0)
            }
        }
    )
}

@Preview
@Composable
private fun AutoScrollTextPreview0() {
    Column(
        modifier = Modifier
            .width(100.dp)
    ) {
        AutoScrollText(
            text = "abcdefghijklmnopqrstuvwxyz",
        )
    }
}
```

### „Éê„É™„Ç®„Éº„Ç∑„Éß„É≥„Çí‰Ωú„Å£„Å¶„Åø„Çã

![](https://github.com/user-attachments/assets/802b4147-5cdd-41cd-b9be-c3d88615695c =550x)

```Kotlin

sealed class AutoScrollType(open val delayMillis: Long) {
    // ÊåáÂÆöÁßíÊï∞„Åã„Åë„Å¶scroll„Åô„Çã
    data class Duration(val millis: Long, override val delayMillis: Long = 0) : AutoScrollType(delayMillis)
    // ÊñáÂ≠óÂàó„ÅÆÈï∑„Åï„Å´Èñ¢„Çè„Çâ„Åö‰∏ÄÂÆö„ÅÆÈÄüÂ∫¶„ÅßÁßªÂãï„Åô„Çã
    data class PerCharacterLength(val millis: Long, override val delayMillis: Long = 0) : AutoScrollType(delayMillis)
}

@Composable
fun AutoScrollText(
    modifier: Modifier = Modifier,
    text: String,
    style: TextStyle = LocalTextStyle.current,
    autoScrollType: AutoScrollType = AutoScrollType.Duration(5000),
    startVisualize: Boolean = true,
) {

    val textWidth = remember { mutableIntStateOf(0) }
    val layoutWidth = remember { mutableIntStateOf(0) }

    val transitionWidth =
        if (startVisualize) textWidth.intValue - layoutWidth.intValue
        else textWidth.intValue

    val animatedOffsetX = remember { Animatable(0f) }

    LaunchedEffect(transitionWidth) {
        while (
            // layout„Çµ„Ç§„Ç∫„Å´Âèé„Åæ„Å£„Å¶„ÅÑ„Çå„Å∞‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            transitionWidth > 0
        ) {
            animatedOffsetX.snapTo(if (startVisualize)  0f else layoutWidth.intValue.toFloat())
            delay(autoScrollType.delayMillis)
            animatedOffsetX.animateTo(
                targetValue = -transitionWidth.toFloat(),
                animationSpec = tween(
                    durationMillis = when (autoScrollType) {
                        is AutoScrollType.Duration -> autoScrollType.millis
                        is AutoScrollType.PerCharacterLength -> transitionWidth * autoScrollType.millis
                    }.toInt(),
                    easing = LinearEasing
                )
            )
            delay(autoScrollType.delayMillis)
        }
    }

    Layout(
        modifier = modifier,
        content = {
            Text(
                text = text,
                style = style,
                maxLines = 1,
                overflow = TextOverflow.Clip
            )
        },
        measurePolicy = { measurable, constraints ->
            val textMeasurable = measurable.first()

            layoutWidth.intValue = constraints.maxWidth

            val placeable = textMeasurable.measure(
                // layout„ÅÆ„Çµ„Ç§„Ç∫„Å´Èñ¢„Çè„Çâ„ÅöÂÖ®„Å¶„ÇíË°®Á§∫„Åô„Çã
                constraints.copy(maxWidth = Int.MAX_VALUE)
            )
            // text„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó„Åô„Çã
            textWidth.intValue = placeable.width
            layout(layoutWidth.intValue, placeable.height) {
                placeable.place(animatedOffsetX.value.toInt(), 0)
            }
        }
    )
}

@Preview
@Composable
private fun AutoScrollTextPreview0() {
    ShiftTheme {
        Column(
            modifier = Modifier
                .background(ShiftTheme.colorScheme.background.primary)
                .width(100.dp)
        ) {
            AutoScrollText(
                text = "abcdefghijklmnopqrstuvwxyz",
            )
        }
    }
}

@Preview
@Composable
private fun AutoScrollTextPreview() {
    Column(
        modifier = Modifier
            .width(100.dp)
    ) {
        AutoScrollText(
            text = "abcdefghijklmnopqrstuvwxyz",
            autoScrollType = AutoScrollType.Duration(3000, 500),
            startVisualize = true
        )
        AutoScrollText(
            text = "abcdefghijklmnopqrstuvwxyz",
            autoScrollType = AutoScrollType.Duration(3000),
            startVisualize = false
        )
        AutoScrollText(
            text = "abcdefghijklmnopqrstuvwxyz",
            autoScrollType = AutoScrollType.PerCharacterLength(20),
            startVisualize = true
        )
        AutoScrollText(
            text = "abcdefghijklmnopqrstuvwxyz",
            autoScrollType = AutoScrollType.PerCharacterLength(10),
            startVisualize = false
        )
    }
}
```
